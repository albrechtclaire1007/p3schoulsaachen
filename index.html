<!DOCTYPE html>
<html lang="lb">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Schoulsaachen</title>
<style>
  /* Font */
  @font-face{
    font-family:'Schoulschrëft';
    src:url('https://raw.githubusercontent.com/albrechtclaire1007/schoulschreft/main/schoulschreft_bold%5B2%5D.TTF') format('truetype');
    font-weight:bold; font-style:normal; font-display:swap;
  }

  :root{
    /* P3 blue palette to keep your series coherence while matching the P1 layout */
    --blue-mid:#8ab6d9; --blue-light:#cfe4f6; --blue-dark:#4f7ca0;
    --ink:#173c57; --white:#fff; --bad:#ffcccc; --ok:#b7f0c8;
    --border:3px;
  }

  *{box-sizing:border-box; -webkit-tap-highlight-color:transparent; user-select:none; outline:none;}
  html,body{height:100%; margin:0; background:linear-gradient(135deg,var(--blue-mid),var(--blue-light)); color:var(--ink); font-family:'Schoulschrëft', Arial, sans-serif;}

  /* Top bar (like P1) */
  .top{
    position:sticky; top:8px; z-index:10; display:flex; gap:10px; align-items:center; justify-content:center;
    background:var(--white); border:var(--border) solid var(--blue-dark); border-radius:18px;
    padding:.35rem .6rem; margin:10px auto; width:fit-content;
    box-shadow:0 8px 24px rgba(0,0,0,.08);
  }
  .iconBtn{
    border:var(--border) solid var(--ink); background:var(--white); color:var(--ink);
    padding:.25rem .7rem; border-radius:14px; cursor:pointer; font-size:1.4rem; line-height:1;
    min-width:2.4rem; display:grid; place-items:center;
  }
  .iconBtn:active{ transform:scale(.98); }
  .flow{opacity:.9; font-size:1rem; padding:0 .4rem; min-width:10ch; text-align:center;}
  .sep{width:1px; height:20px; background:#ddd; margin:0 6px;}
  .toggle{
    border:var(--border) solid var(--ink); background:var(--white); color:var(--ink);
    padding:.25rem .6rem; border-radius:14px; cursor:pointer; font-size:1rem;
  }
  .hidden{display:none !important;}

  .wrap{min-height:100%; display:flex; flex-direction:column; align-items:center; gap:2.5vmin; padding:2.5vmin 3vmin 4vmin;}
  h1{margin:.2rem 0 0; text-align:center; font-size:clamp(2rem,6vmin,4.2rem); color:var(--ink);}

  /* Generic grid / tokens (P1 style) */
  .grid{
    width:95vw; max-width:2000px; display:grid; gap:2vmin;
    grid-template-columns: repeat(auto-fill, minmax(14vmin, 1fr));
    align-items:stretch;
  }
  .imgToken{
    background:var(--white); border:6px solid var(--blue-mid); border-radius:22px;
    display:grid; place-items:center; aspect-ratio:1/1; cursor:pointer;
    transition:transform .1s ease, border-color .15s ease, filter .15s ease, background .15s ease;
    box-shadow:0 10px 26px rgba(0,0,0,.08);
  }
  .imgToken:active{ transform:scale(.97); }
  .imgToken img{ width:90%; height:90%; object-fit:contain; }

  .btn{
    border:var(--border) solid var(--ink); background:var(--white); color:var(--ink);
    padding:.45rem .85rem; border-radius:14px; cursor:pointer; font-size:1.05rem;
  }
  .btn:active{ transform:scale(.98); }

  .flash-good{ background:var(--ok) !important; border-color:var(--ok) !important; }
  .flash-bad{ background:var(--bad) !important; border-color:var(--bad) !important; }

  /* Big centered image box (for G3, also reused vertically) */
  .bigBox{
    width:min(70vmin,90%); aspect-ratio:1/1; background:#fff;
    border:12px solid var(--blue-mid); border-radius:40px; display:grid; place-items:center;
    position:relative; cursor:pointer;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
    transition:transform .12s ease;
  }
  .bigBox:active{ transform:scale(.98); }
  .bigBox img{ width:85%; height:85%; object-fit:contain; }
  .fade{ animation:fadeIn .35s ease; }
  @keyframes fadeIn{ from{opacity:0; transform:scale(.9)} to{opacity:1; transform:scale(1)} }

  /* Spelling (G2) */
  .slots{ display:flex; gap:.6rem; flex-wrap:wrap; justify-content:center; padding:.4rem; }
  .slot{
    min-width:3.2rem; min-height:4.0rem; border-bottom:6px solid var(--ink);
    display:grid; place-items:center; font-size:clamp(2rem,5.8vmin,3.2rem);
  }
  .letters{ display:flex; gap:.5rem; flex-wrap:wrap; justify-content:center; }
  .letter{
    background:#fff; border:4px solid var(--ink); border-radius:12px; padding:.35rem .55rem;
    cursor:pointer; font-size:clamp(2rem,5.8vmin,3.2rem); min-width:3.2rem; text-align:center;
  }

  /* Choices line (articles/plurals) */
  .choices{ display:flex; gap:.6rem; flex-wrap:wrap; justify-content:center; }
  .choice{ background:#fff; border:4px solid var(--ink); border-radius:12px; padding:.35rem .7rem; cursor:pointer; font-size:clamp(1.6rem,4.6vmin,2.2rem); }

  /* G5 inline tokens */
  .inlineRow{ display:flex; align-items:center; justify-content:center; gap:min(2.4vmin,18px); flex-wrap:wrap; }
  .numSq, .colSq{
    display:grid; place-items:center; width:min(16vmin,160px); aspect-ratio:1/1;
    border:8px solid var(--blue-mid); border-radius:18px; background:#fff; font-size:clamp(2rem,5vmin,3rem);
    box-shadow:0 8px 24px rgba(0,0,0,.08);
  }
  .miniImg{
    display:grid; place-items:center; width:min(22vmin,240px); aspect-ratio:1/1;
    border:8px solid var(--blue-mid); border-radius:18px; background:#fff;
    box-shadow:0 8px 24px rgba(0,0,0,.08);
  }
  .miniImg img{ width:85%; height:85%; object-fit:contain; }
  .verb{
    display:inline-block; padding:.2rem .8rem; border:6px solid var(--blue-mid); border-radius:16px; background:#fff;
    font-size:clamp(2rem,5vmin,3rem);
  }
</style>
</head>
<body>

<!-- Top nav (P1-style) -->
<div class="top">
  <button class="iconBtn" id="prev">◀</button>
  <span class="flow" id="flowLabel">1. Spill</span>
  <button class="iconBtn" id="next">▶</button>
  <span class="sep"></span>
  <button class="toggle" id="soundToggle">Toun: Un</button>
</div>

<!-- G1: Lauschter a klick op dat richtegt Bild (autoplay on target, no per-card buttons) -->
<section class="wrap" id="g1">
  <h1>Lauschter a klick op dat richtegt Bild</h1>
  <div class="grid" id="grid1"></div>
  <div><button class="btn" id="play1">Toun nach eng Kéier</button></div>
</section>

<!-- G2: Schreif d’Wuert – no word shown; image → slots → letters -->
<section class="wrap hidden" id="g2">
  <h1>Schreif d’Wuert</h1>
  <div class="bigBox" style="cursor:default;"><img id="spellImg" alt=""></div>
  <div class="slots" id="spellSlots"></div>
  <div class="letters" id="spellBank"></div>
  <div><button class="btn" id="spellNext">Weider</button></div>
</section>

<!-- G3: Artikel wielen – centered, image on top, choices under -->
<section class="wrap hidden" id="g3">
  <h1>Wiel den Artikel</h1>
  <div class="bigBox" style="cursor:default;"><img id="artImg" alt=""></div>
  <div style="font-size:clamp(2rem,5.6vmin,3.2rem); text-align:center; margin-top:10px;" id="artWord">_____ Numm</div>
  <div class="choices" id="artChoices"></div>
  <div><button class="btn" id="artNext">Weider</button></div>
</section>

<!-- G4: Plural – big word centered; generates distractors (-en/-er/-s + vowel tweaks) -->
<section class="wrap hidden" id="g4">
  <h1>Plural</h1>
  <div style="font-size:clamp(2.4rem,6.2vmin,3.6rem); text-align:center;" id="pluWord">Wuert</div>
  <div class="choices" id="pluChoices"></div>
  <div><button class="btn" id="pluNext">Weider</button></div>
</section>

<!-- G5: Number square – image – sinn – colour square (no full sentence text) -->
<section class="wrap hidden" id="g5">
  <h1>Lies de Saz</h1>
  <div class="inlineRow" id="sentRow">
    <div class="numSq" id="sentNum">3</div>
    <div class="miniImg"><img id="sentImg" alt=""></div>
    <span class="verb">sinn</span>
    <div class="colSq" id="sentCol"></div>
  </div>
  <div><button class="btn" id="sentNext">Neie Saz</button></div>
</section>

<audio id="speaker" preload="auto"></audio>

<script>
/* ---------- DATA (from your previous P3 code) ---------- */
const AUDIO_BASE = "https://github.com/albrechtclaire1007/p3schoulsaachen/raw/refs/heads/main/";
const AUDIO_FILES = {
  "d'Buch": "BUCH.mp3",
  "de Bläistëft": "Bläistëft.mp3",
  "de Classeur": "Classeuren.mp3",
  "de Gummi": "GUMMI.mp3",
  "d'Heft": "HEFT.mp3",
  "d'Kräid": "KRÄID.mp3",
  "d'Léierin": "léierin.mp3",
  "de Lineal": "LINEAL.mp3",
  "d'Blat Pabeier": "PABEIER.mp3",
  "de Pech": "pech.mp3",
  "d'Schachtel": "SCHACHTEL.mp3",
  "de Schwamp": "Schamm.mp3",
  "d'Schéier": "SCHEIER.mp3",
  "de Schoulsak": "Schoulsak.mp3",
  "de Spëtzer": "spëtzer.mp3",
  "d'Tafel": "tafel.mp3",
  "d'Tuschfaarf": "tuschfaarf.mp3",
  "d'Bläistëftsfaarf": "blaischteftsfaarf.mp3"
};
const ITEMS = [
  {id:'schoulsak',   label:"de Schoulsak",      img:"https://i.postimg.cc/bdTXYnWk/23.png"},
  {id:'buch',        label:"d'Buch",            img:"https://i.postimg.cc/nMpTLDYK/temp-Image5-PKPI3.avif"},
  {id:'heft',        label:"d'Heft",            img:"https://i.postimg.cc/F1QmHNR5/17.png"},
  {id:'classeur',    label:"de Classeur",       img:"https://i.postimg.cc/LnxMDPV2/20.png"},
  {id:'schachtel',   label:"d'Schachtel",       img:"https://i.postimg.cc/LJ8b80LM/8.png"},
  {id:'blaisteftsf', label:"d'Bläistëftsfaarf", img:"https://i.postimg.cc/RJCYyM72/16.png"},
  {id:'tuschfaarf',  label:"d'Tuschfaarf",      img:"https://i.postimg.cc/bD9MmGtQ/15.png"},
  {id:'lineal',      label:"de Lineal",         img:"https://i.postimg.cc/14DTCFsb/14.png"},
  {id:'gummi',       label:"de Gummi",          img:"https://i.postimg.cc/t1xQ9MG4/21.png"},
  {id:'scheier',     label:"d'Schéier",         img:"https://i.postimg.cc/HcXSNGDb/16.png"},
  {id:'pech',        label:"de Pech",           img:"https://i.postimg.cc/vcMKpmmT/7.png"},
  {id:'tafel',       label:"d'Tafel",           img:"https://i.postimg.cc/GTLjgWhg/temp-Image-Oxa-Tk-S.avif"},
  {id:'kraid',       label:"d'Kräid",           img:"https://i.postimg.cc/fVqgtjfS/15.png"},
  {id:'blat',        label:"d'Blat Pabeier",    img:"https://i.postimg.cc/dLBfvK7B/13.png"},
  {id:'schwamp',     label:"de Schwamp",        img:"https://i.postimg.cc/kBX024PZ/24.png"},
  {id:'blaisteft',   label:"de Bläistëft",      img:"https://i.postimg.cc/tnGcRqtr/6.png"},
  {id:'spetzer',     label:"de Spëtzer",        img:"https://i.postimg.cc/njf8rGnY/22.png"},
  {id:'leierin',     label:"d'Léierin",         img:"https://i.postimg.cc/qh0cgPnB/temp-Imagevl-Joig.avif"}
];

/* Optional LEXICON: add confirmed plurals to enable G4 + improve G5 choice pool */
const LEXICON = {
  // id: { article:"de|den|d'", noun:"...", plural:"..." }
  classeur: { article:"de", noun:"Classeur", plural:"Classeuren" },
  // Fill more when you have the sheet; missing ones are skipped in G4 on purpose.
};

/* Colours & numbers for G5 */
const COLOURS = [
  {name:"blo",  hex:"#4C78A8"},
  {name:"rout", hex:"#E45756"},
  {name:"gréng",hex:"#72B7B2"},
  {name:"giel", hex:"#F1A33C"},
  {name:"rosa", hex:"#E46BA0"},
  {name:"orange",hex:"#F58518"},
  {name:"mof",  hex:"#7E6ACE"},
  {name:"schwaarz", hex:"#2D2D2D"}
];
const NUMBERS = [2,3,4,5,6,7,8,9,10];

/* ---------- UTIL ---------- */
const speaker = document.getElementById('speaker');
let soundOn = true;
function playLabel(label){
  if(!soundOn) return;
  const f = AUDIO_FILES[label];
  if(f){ playSound(AUDIO_BASE + encodeURIComponent(f)); }
}
async function playSound(src){ try{ if(speaker.src!==src) speaker.src=src; await speaker.play(); }catch(e){} }
function flash(el, ok){
  el.classList.remove('flash-good','flash-bad');
  void el.offsetWidth;
  el.classList.add(ok ? 'flash-good' : 'flash-bad');
  setTimeout(()=> el.classList.remove('flash-good','flash-bad'), 260);
}
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
function stripArticle(label){ return label.replace(/^(d')/i,"").replace(/^(de|den)\s+/i,"").trim(); }
function getLex(id){
  const base = ITEMS.find(x=>x.id===id);
  const lex  = LEXICON[id] || {};
  return {
    id,
    label: base.label,
    img: base.img,
    article: lex.article || (base.label.startsWith("d'") ? "d'" : (base.label.startsWith("den ") ? "den" : "de")),
    noun: lex.noun || stripArticle(base.label),
    plural: lex.plural || null
  };
}

/* ---------- NAV ---------- */
const pages = ["g1","g2","g3","g4","g5"];
let pageIdx = 0;
const flowLabel = document.getElementById('flowLabel');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
function labelFor(i){ return `${i+1}. Spill`; }
function updateNav(){
  flowLabel.textContent = labelFor(pageIdx);
  prevBtn.classList.toggle('hidden', pageIdx===0);
  nextBtn.classList.toggle('hidden', pageIdx===pages.length-1);
}
function showPage(i){
  pageIdx = Math.max(0, Math.min(pages.length-1, i));
  pages.forEach((id,idx)=>document.getElementById(id).classList.toggle('hidden', idx!==pageIdx));
  updateNav();
}
prevBtn.onclick = ()=> showPage(pageIdx-1);
nextBtn.onclick = ()=> showPage(pageIdx+1);

const soundToggle = document.getElementById('soundToggle');
soundToggle.onclick = ()=>{ soundOn=!soundOn; soundToggle.textContent = soundOn ? 'Toun: Un' : 'Toun: Aus'; };

/* ---------- G1: Listen & click correct image (autoplay on target) ---------- */
const grid1 = document.getElementById('grid1');
const play1 = document.getElementById('play1');
let bag1 = shuffle([...ITEMS]);
let target1 = null;

function layoutG1(){
  grid1.innerHTML = "";
  shuffle([...ITEMS]).forEach(it=>{
    const b = document.createElement('button');
    b.className = 'imgToken';
    const img = document.createElement('img');
    img.src = it.img; img.alt = it.label;
    b.appendChild(img);
    b.onclick = ()=> checkG1(it, b);
    grid1.appendChild(b);
  });
}
function nextG1(){
  if(bag1.length===0){ showPage(pageIdx+1); return; }
  target1 = bag1.pop();
  playLabel(target1.label); // AUTOPLAY (respects Toun)
}
function checkG1(it, el){
  const ok = (it.id === target1.id);
  flash(el, ok);
  if(ok){ setTimeout(nextG1, 280); }
}
play1.onclick = ()=> { if(target1) playLabel(target1.label); };

/* ---------- G2: Spell the word (no word shown) ---------- */
const spellImg   = document.getElementById('spellImg');
const spellSlots = document.getElementById('spellSlots');
const spellBank  = document.getElementById('spellBank');
const spellNext  = document.getElementById('spellNext');
let bag2 = shuffle([...ITEMS]); let cur2 = null;

function setupSpellRound(){
  if(bag2.length===0){ showPage(pageIdx+1); return; }
  cur2 = bag2.pop();
  const lex = getLex(cur2.id);
  const noun = lex.noun.replace(/\s+/g,''); // letters only
  spellImg.src = cur2.img; spellImg.alt = lex.label;
  spellImg.classList.remove('fade'); void spellImg.offsetWidth; spellImg.classList.add('fade');

  // build slots
  spellSlots.innerHTML = "";
  spellBank.innerHTML  = "";
  const letters = [...noun];
  const shuffled = shuffle(letters.slice());

  // slots
  const slotEls = letters.map((_ch,i)=>{
    const s = document.createElement('div'); s.className='slot'; s.dataset.idx=i; s.dataset.ch='';
    // drop
    s.addEventListener('dragover',e=>e.preventDefault());
    s.addEventListener('drop',e=>{
      e.preventDefault();
      const ch = e.dataTransfer.getData('text/plain');
      if(!s.textContent){ s.textContent = ch; s.dataset.ch = ch; checkSpell(); }
    });
    // click to remove
    s.addEventListener('click',()=>{
      if(!s.textContent) return;
      const ch = s.textContent; s.textContent=''; s.dataset.ch='';
      addLetterToBank(ch);
    });
    spellSlots.appendChild(s);
    return s;
  });

  // bank (drag + click to place in first empty slot)
  function addLetterToBank(ch){
    const l = document.createElement('div'); l.className='letter'; l.textContent = ch; l.draggable=true;
    l.addEventListener('dragstart',e=>e.dataTransfer.setData('text/plain', ch));
    l.addEventListener('click',()=>{
      const empty = slotEls.find(s=>!s.textContent);
      if(empty){ empty.textContent=ch; empty.dataset.ch=ch; l.remove(); checkSpell(); }
    });
    spellBank.appendChild(l);
  }
  shuffled.forEach(addLetterToBank);

  function checkSpell(){
    const got = slotEls.map(s=>s.dataset.ch).join('');
    if(got.length !== letters.length) return;
    if(got === letters.join('')){ flash(spellImg.parentElement, true); setTimeout(setupSpellRound, 450); }
    else { flash(spellImg.parentElement, false); }
  }
}
spellNext.onclick = setupSpellRound;

/* ---------- G3: Article picker (centered) ---------- */
const artImg     = document.getElementById('artImg');
const artWord    = document.getElementById('artWord');
const artChoices = document.getElementById('artChoices');
const artNext    = document.getElementById('artNext');
let bag3 = shuffle([...ITEMS]); let cur3=null;

function setupArtRound(){
  if(bag3.length===0){ showPage(pageIdx+1); return; }
  cur3 = bag3.pop();
  const lex = getLex(cur3.id);
  artImg.src = cur3.img; artImg.alt = lex.label;
  artImg.classList.remove('fade'); void artImg.offsetWidth; artImg.classList.add('fade');
  artWord.textContent = `_____ ${lex.noun}`;
  artChoices.innerHTML = "";
  const opts = ["de","den","d'"];
  shuffle(opts).forEach(o=>{
    const b = document.createElement('button'); b.className='choice'; b.textContent=o;
    b.onclick = ()=>{
      const ok = (o===lex.article);
      flash(artImg.parentElement, ok);
      if(ok) setTimeout(setupArtRound, 450);
    };
    artChoices.appendChild(b);
  });
}
artNext.onclick = setupArtRound;

/* ---------- G4: Plural quiz (big word + smart distractors) ---------- */
const pluWord    = document.getElementById('pluWord');
const pluChoices = document.getElementById('pluChoices');
const pluNext    = document.getElementById('pluNext');
let pool4 = ITEMS.map(i=>getLex(i.id)).filter(x=>x.plural); // only items with confirmed plural

function pluralDistractors(baseSing, correct){
  const stems = [
    baseSing.replace(/e/g,'ë').replace(/a/g,'ä'),
    baseSing.replace(/ë/g,'e').replace(/ä/g,'a'),
    baseSing
  ];
  const suffixes = ['en','er','s'];
  const cand = new Set();
  stems.forEach(st=>{
    suffixes.forEach(suf=> cand.add(st + suf));
  });
  cand.delete(correct);
  // Add a couple funny near-misses (swap r/l, duplicate vowel)
  cand.add(baseSing.replace(/l/,'ll')+'en');
  cand.add(baseSing.replace(/r/,'rr')+'er');
  return shuffle([...cand]).slice(0,3);
}

function setupPluralRound(){
  if(pool4.length===0){ // nothing to ask until lexicon filled
    pluWord.textContent="Fëllt d’Plurale fir méi Froen.";
    pluChoices.innerHTML="";
    return;
  }
  const cur = pool4[Math.floor(Math.random()*pool4.length)];
  pluWord.textContent = cur.label;
  const wrong = pluralDistractors(cur.noun, cur.plural);
  const opts = shuffle([cur.plural, ...wrong]);
  pluChoices.innerHTML="";
  opts.forEach(o=>{
    const b=document.createElement('button'); b.className='choice'; b.textContent=o;
    b.onclick=()=>{
      const ok = (o===cur.plural);
      flash(pluWord, ok);
      if(ok) setTimeout(setupPluralRound, 450);
    };
    pluChoices.appendChild(b);
  });
}
pluNext.onclick = setupPluralRound;

/* ---------- G5: Number square – image – sinn – colour square ---------- */
const sentNum = document.getElementById('sentNum');
const sentImg = document.getElementById('sentImg');
const sentCol = document.getElementById('sentCol');
const sentNext= document.getElementById('sentNext');

function setupSentence(){
  const it = ITEMS[Math.floor(Math.random()*ITEMS.length)];
  const lex = getLex(it.id);
  const n = NUMBERS[Math.floor(Math.random()*NUMBERS.length)];
  const c = COLOURS[Math.floor(Math.random()*COLOURS.length)];
  sentNum.textContent = n;
  sentImg.src = it.img; sentImg.alt = lex.label;
  sentCol.style.background = c.hex;
  // (No full sentence text — only blocks as requested)
}
sentNext.onclick = setupSentence;

/* ---------- INIT ---------- */
function init(){
  // G1
  layoutG1(); nextG1();
  // G2
  setupSpellRound();
  // G3
  setupArtRound();
  // G4
  setupPluralRound();
  // G5
  setupSentence();
  // start
  showPage(0);
}
init();
</script>
</body>
</html>
